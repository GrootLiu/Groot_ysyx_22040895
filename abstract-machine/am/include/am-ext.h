# 1 "am.h"
# 1 "<built-in>"
# 1 "<command-line>"
# 31 "<command-line>"
# 1 "/usr/include/stdc-predef.h" 1 3 4
# 32 "<command-line>" 2
# 1 "am.h"



# 1 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stdint.h" 1 3 4
# 9 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stdint.h" 3 4
# 1 "/usr/include/stdint.h" 1 3 4
# 26 "/usr/include/stdint.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/libc-header-start.h" 1 3 4
# 33 "/usr/include/x86_64-linux-gnu/bits/libc-header-start.h" 3 4
# 1 "/usr/include/features.h" 1 3 4
# 469 "/usr/include/features.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/sys/cdefs.h" 1 3 4
# 462 "/usr/include/x86_64-linux-gnu/sys/cdefs.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/wordsize.h" 1 3 4
# 463 "/usr/include/x86_64-linux-gnu/sys/cdefs.h" 2 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/long-double.h" 1 3 4
# 464 "/usr/include/x86_64-linux-gnu/sys/cdefs.h" 2 3 4
# 470 "/usr/include/features.h" 2 3 4
# 493 "/usr/include/features.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/gnu/stubs.h" 1 3 4
# 10 "/usr/include/x86_64-linux-gnu/gnu/stubs.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/gnu/stubs-64.h" 1 3 4
# 11 "/usr/include/x86_64-linux-gnu/gnu/stubs.h" 2 3 4
# 494 "/usr/include/features.h" 2 3 4
# 34 "/usr/include/x86_64-linux-gnu/bits/libc-header-start.h" 2 3 4
# 27 "/usr/include/stdint.h" 2 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/types.h" 1 3 4
# 27 "/usr/include/x86_64-linux-gnu/bits/types.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/wordsize.h" 1 3 4
# 28 "/usr/include/x86_64-linux-gnu/bits/types.h" 2 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/timesize.h" 1 3 4
# 29 "/usr/include/x86_64-linux-gnu/bits/types.h" 2 3 4



# 31 "/usr/include/x86_64-linux-gnu/bits/types.h" 3 4
typedef unsigned char __u_char;
typedef unsigned short int __u_short;
typedef unsigned int __u_int;
typedef unsigned long int __u_long;


typedef signed char __int8_t;
typedef unsigned char __uint8_t;
typedef signed short int __int16_t;
typedef unsigned short int __uint16_t;
typedef signed int __int32_t;
typedef unsigned int __uint32_t;

typedef signed long int __int64_t;
typedef unsigned long int __uint64_t;






typedef __int8_t __int_least8_t;
typedef __uint8_t __uint_least8_t;
typedef __int16_t __int_least16_t;
typedef __uint16_t __uint_least16_t;
typedef __int32_t __int_least32_t;
typedef __uint32_t __uint_least32_t;
typedef __int64_t __int_least64_t;
typedef __uint64_t __uint_least64_t;



typedef long int __quad_t;
typedef unsigned long int __u_quad_t;







typedef long int __intmax_t;
typedef unsigned long int __uintmax_t;
# 141 "/usr/include/x86_64-linux-gnu/bits/types.h" 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/typesizes.h" 1 3 4
# 142 "/usr/include/x86_64-linux-gnu/bits/types.h" 2 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/time64.h" 1 3 4
# 143 "/usr/include/x86_64-linux-gnu/bits/types.h" 2 3 4


typedef unsigned long int __dev_t;
typedef unsigned int __uid_t;
typedef unsigned int __gid_t;
typedef unsigned long int __ino_t;
typedef unsigned long int __ino64_t;
typedef unsigned int __mode_t;
typedef unsigned long int __nlink_t;
typedef long int __off_t;
typedef long int __off64_t;
typedef int __pid_t;
typedef struct { int __val[2]; } __fsid_t;
typedef long int __clock_t;
typedef unsigned long int __rlim_t;
typedef unsigned long int __rlim64_t;
typedef unsigned int __id_t;
typedef long int __time_t;
typedef unsigned int __useconds_t;
typedef long int __suseconds_t;
typedef long int __suseconds64_t;

typedef int __daddr_t;
typedef int __key_t;


typedef int __clockid_t;


typedef void * __timer_t;


typedef long int __blksize_t;




typedef long int __blkcnt_t;
typedef long int __blkcnt64_t;


typedef unsigned long int __fsblkcnt_t;
typedef unsigned long int __fsblkcnt64_t;


typedef unsigned long int __fsfilcnt_t;
typedef unsigned long int __fsfilcnt64_t;


typedef long int __fsword_t;

typedef long int __ssize_t;


typedef long int __syscall_slong_t;

typedef unsigned long int __syscall_ulong_t;



typedef __off64_t __loff_t;
typedef char *__caddr_t;


typedef long int __intptr_t;


typedef unsigned int __socklen_t;




typedef int __sig_atomic_t;
# 28 "/usr/include/stdint.h" 2 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/wchar.h" 1 3 4
# 29 "/usr/include/stdint.h" 2 3 4
# 1 "/usr/include/x86_64-linux-gnu/bits/wordsize.h" 1 3 4
# 30 "/usr/include/stdint.h" 2 3 4




# 1 "/usr/include/x86_64-linux-gnu/bits/stdint-intn.h" 1 3 4
# 24 "/usr/include/x86_64-linux-gnu/bits/stdint-intn.h" 3 4
typedef __int8_t int8_t;
typedef __int16_t int16_t;
typedef __int32_t int32_t;
typedef __int64_t int64_t;
# 35 "/usr/include/stdint.h" 2 3 4


# 1 "/usr/include/x86_64-linux-gnu/bits/stdint-uintn.h" 1 3 4
# 24 "/usr/include/x86_64-linux-gnu/bits/stdint-uintn.h" 3 4
typedef __uint8_t uint8_t;
typedef __uint16_t uint16_t;
typedef __uint32_t uint32_t;
typedef __uint64_t uint64_t;
# 38 "/usr/include/stdint.h" 2 3 4





typedef __int_least8_t int_least8_t;
typedef __int_least16_t int_least16_t;
typedef __int_least32_t int_least32_t;
typedef __int_least64_t int_least64_t;


typedef __uint_least8_t uint_least8_t;
typedef __uint_least16_t uint_least16_t;
typedef __uint_least32_t uint_least32_t;
typedef __uint_least64_t uint_least64_t;





typedef signed char int_fast8_t;

typedef long int int_fast16_t;
typedef long int int_fast32_t;
typedef long int int_fast64_t;
# 71 "/usr/include/stdint.h" 3 4
typedef unsigned char uint_fast8_t;

typedef unsigned long int uint_fast16_t;
typedef unsigned long int uint_fast32_t;
typedef unsigned long int uint_fast64_t;
# 87 "/usr/include/stdint.h" 3 4
typedef long int intptr_t;


typedef unsigned long int uintptr_t;
# 101 "/usr/include/stdint.h" 3 4
typedef __intmax_t intmax_t;
typedef __uintmax_t uintmax_t;
# 10 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stdint.h" 2 3 4
# 5 "am.h" 2
# 1 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stddef.h" 1 3 4
# 143 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stddef.h" 3 4
typedef long int ptrdiff_t;
# 209 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stddef.h" 3 4
typedef long unsigned int size_t;
# 321 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stddef.h" 3 4
typedef int wchar_t;
# 415 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stddef.h" 3 4
typedef struct {
  long long __max_align_ll __attribute__((__aligned__(__alignof__(long long))));
  long double __max_align_ld __attribute__((__aligned__(__alignof__(long double))));
# 426 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stddef.h" 3 4
} max_align_t;
# 6 "am.h" 2
# 1 "/usr/lib/gcc/x86_64-linux-gnu/10/include/stdbool.h" 1 3 4
# 7 "am.h" 2
# 16 "am.h"

# 16 "am.h"
typedef struct {
  void *start, *end;
} Area;


typedef struct Context Context;


typedef struct {
  enum {
    EVENT_NULL = 0,
    EVENT_YIELD, EVENT_SYSCALL, EVENT_PAGEFAULT, EVENT_ERROR,
    EVENT_IRQ_TIMER, EVENT_IRQ_IODEV,
  } event;
  uintptr_t cause, ref;
  const char *msg;
} Event;



typedef struct {
  int pgsize;
  Area area;
  void *ptr;
} AddrSpace;






extern Area heap;
void putch (char ch);
void halt (int code) __attribute__((__noreturn__));



# 52 "am.h" 3 4
_Bool 
# 52 "am.h"
        ioe_init (void);
void ioe_read (int reg, void *buf);
void ioe_write (int reg, void *buf);
# 1 "amdev.h" 1
# 10 "amdev.h"
enum { AM_UART_CONFIG = (1) }; typedef struct { 
# 10 "amdev.h" 3 4
_Bool 
# 10 "amdev.h"
present; } AM_UART_CONFIG_T;;
enum { AM_UART_TX = (2) }; typedef struct { char data; } AM_UART_TX_T;;
enum { AM_UART_RX = (3) }; typedef struct { char data; } AM_UART_RX_T;;
enum { AM_TIMER_CONFIG = (4) }; typedef struct { 
# 13 "amdev.h" 3 4
_Bool 
# 13 "amdev.h"
present, has_rtc; } AM_TIMER_CONFIG_T;;
enum { AM_TIMER_RTC = (5) }; typedef struct { int year, month, day, hour, minute, second; } AM_TIMER_RTC_T;;
enum { AM_TIMER_UPTIME = (6) }; typedef struct { uint64_t us; } AM_TIMER_UPTIME_T;;
enum { AM_INPUT_CONFIG = (7) }; typedef struct { 
# 16 "amdev.h" 3 4
_Bool 
# 16 "amdev.h"
present; } AM_INPUT_CONFIG_T;;
enum { AM_INPUT_KEYBRD = (8) }; typedef struct { 
# 17 "amdev.h" 3 4
_Bool 
# 17 "amdev.h"
keydown; int keycode; } AM_INPUT_KEYBRD_T;;
enum { AM_GPU_CONFIG = (9) }; typedef struct { 
# 18 "amdev.h" 3 4
_Bool 
# 18 "amdev.h"
present, has_accel; int width, height, vmemsz; } AM_GPU_CONFIG_T;;
enum { AM_GPU_STATUS = (10) }; typedef struct { 
# 19 "amdev.h" 3 4
_Bool 
# 19 "amdev.h"
ready; } AM_GPU_STATUS_T;;
enum { AM_GPU_FBDRAW = (11) }; typedef struct { int x, y; void *pixels; int w, h; 
# 20 "amdev.h" 3 4
_Bool 
# 20 "amdev.h"
sync; } AM_GPU_FBDRAW_T;;
enum { AM_GPU_MEMCPY = (12) }; typedef struct { uint32_t dest; void *src; int size; } AM_GPU_MEMCPY_T;;
enum { AM_GPU_RENDER = (13) }; typedef struct { uint32_t root; } AM_GPU_RENDER_T;;
enum { AM_AUDIO_CONFIG = (14) }; typedef struct { 
# 23 "amdev.h" 3 4
_Bool 
# 23 "amdev.h"
present; int bufsize; } AM_AUDIO_CONFIG_T;;
enum { AM_AUDIO_CTRL = (15) }; typedef struct { int freq, channels, samples; } AM_AUDIO_CTRL_T;;
enum { AM_AUDIO_STATUS = (16) }; typedef struct { int count; } AM_AUDIO_STATUS_T;;
enum { AM_AUDIO_PLAY = (17) }; typedef struct { Area buf; } AM_AUDIO_PLAY_T;;
enum { AM_DISK_CONFIG = (18) }; typedef struct { 
# 27 "amdev.h" 3 4
_Bool 
# 27 "amdev.h"
present; int blksz, blkcnt; } AM_DISK_CONFIG_T;;
enum { AM_DISK_STATUS = (19) }; typedef struct { 
# 28 "amdev.h" 3 4
_Bool 
# 28 "amdev.h"
ready; } AM_DISK_STATUS_T;;
enum { AM_DISK_BLKIO = (20) }; typedef struct { 
# 29 "amdev.h" 3 4
_Bool 
# 29 "amdev.h"
write; void *buf; int blkno, blkcnt; } AM_DISK_BLKIO_T;;
enum { AM_NET_CONFIG = (21) }; typedef struct { 
# 30 "amdev.h" 3 4
_Bool 
# 30 "amdev.h"
present; } AM_NET_CONFIG_T;;
enum { AM_NET_STATUS = (22) }; typedef struct { int rx_len, tx_len; } AM_NET_STATUS_T;;
enum { AM_NET_TX = (23) }; typedef struct { Area buf; } AM_NET_TX_T;;
enum { AM_NET_RX = (24) }; typedef struct { Area buf; } AM_NET_RX_T;;
# 47 "amdev.h"
enum {
  AM_KEY_NONE = 0,
  AM_KEY_ESCAPE, AM_KEY_F1, AM_KEY_F2, AM_KEY_F3, AM_KEY_F4, AM_KEY_F5, AM_KEY_F6, AM_KEY_F7, AM_KEY_F8, AM_KEY_F9, AM_KEY_F10, AM_KEY_F11, AM_KEY_F12, AM_KEY_GRAVE, AM_KEY_1, AM_KEY_2, AM_KEY_3, AM_KEY_4, AM_KEY_5, AM_KEY_6, AM_KEY_7, AM_KEY_8, AM_KEY_9, AM_KEY_0, AM_KEY_MINUS, AM_KEY_EQUALS, AM_KEY_BACKSPACE, AM_KEY_TAB, AM_KEY_Q, AM_KEY_W, AM_KEY_E, AM_KEY_R, AM_KEY_T, AM_KEY_Y, AM_KEY_U, AM_KEY_I, AM_KEY_O, AM_KEY_P, AM_KEY_LEFTBRACKET, AM_KEY_RIGHTBRACKET, AM_KEY_BACKSLASH, AM_KEY_CAPSLOCK, AM_KEY_A, AM_KEY_S, AM_KEY_D, AM_KEY_F, AM_KEY_G, AM_KEY_H, AM_KEY_J, AM_KEY_K, AM_KEY_L, AM_KEY_SEMICOLON, AM_KEY_APOSTROPHE, AM_KEY_RETURN, AM_KEY_LSHIFT, AM_KEY_Z, AM_KEY_X, AM_KEY_C, AM_KEY_V, AM_KEY_B, AM_KEY_N, AM_KEY_M, AM_KEY_COMMA, AM_KEY_PERIOD, AM_KEY_SLASH, AM_KEY_RSHIFT, AM_KEY_LCTRL, AM_KEY_APPLICATION, AM_KEY_LALT, AM_KEY_SPACE, AM_KEY_RALT, AM_KEY_RCTRL, AM_KEY_UP, AM_KEY_DOWN, AM_KEY_LEFT, AM_KEY_RIGHT, AM_KEY_INSERT, AM_KEY_DELETE, AM_KEY_HOME, AM_KEY_END, AM_KEY_PAGEUP, AM_KEY_PAGEDOWN,
};







typedef uint32_t gpuptr_t;

struct gpu_texturedesc {
  uint16_t w, h;
  gpuptr_t pixels;
} __attribute__((packed));

struct gpu_canvas {
  uint16_t type, w, h, x1, y1, w1, h1;
  gpuptr_t sibling;
  union {
    gpuptr_t child;
    struct gpu_texturedesc texture;
  };
} __attribute__((packed));
# 56 "am.h" 2



# 58 "am.h" 3 4
_Bool 
# 58 "am.h"
        cte_init (Context *(*handler)(Event ev, Context *ctx));
void yield (void);

# 60 "am.h" 3 4
_Bool 
# 60 "am.h"
        ienabled (void);
void iset (
# 61 "am.h" 3 4
                     _Bool 
# 61 "am.h"
                          enable);
Context *kcontext (Area kstack, void (*entry)(void *), void *arg);



# 65 "am.h" 3 4
_Bool 
# 65 "am.h"
        vme_init (void *(*pgalloc)(int), void (*pgfree)(void *));
void protect (AddrSpace *as);
void unprotect (AddrSpace *as);
void map (AddrSpace *as, void *vaddr, void *paddr, int prot);
Context *ucontext (AddrSpace *as, Area kstack, void *entry);



# 72 "am.h" 3 4
_Bool 
# 72 "am.h"
        mpe_init (void (*entry)());
int cpu_count (void);
int cpu_current (void);
int atomic_xchg (int *addr, int newval);
